<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HyperDesigner</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', sans-serif;
}

body {
  background-color: #ffffff;
}

/* HERO */
.hero {
  background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
  padding: 80px 20px;
  text-align: center;
  color: white;
  clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%);
}

.logo {
  font-weight: bold;
  letter-spacing: 2px;
  margin-bottom: 30px;
}

h1 {
  font-size: 3rem;
  margin-bottom: 20px;
}

.btn-main {
  background: white;
  color: #3a7bd5;
  padding: 15px 50px;
  border-radius: 30px;
  border: none;
  cursor: pointer;
  font-weight: bold;
}

/* CONTAINER */
.container {
  max-width: 1000px;
  margin: 40px auto;
  padding: 20px;
  text-align: center;
}

.hidden {
  display: none;
}

/* OPTIONS */
.options-grid {
  display: flex;
  justify-content: space-around;
  gap: 40px;
}

.option-card {
  flex: 1;
}

.card-box {
  background-color: #2980b9;
  color: white;
  padding: 40px 20px;
  border-radius: 15px;
  margin-bottom: 20px;
}

/* UPLOAD */
.upload-area {
  border: 2px dashed #bdc3c7;
  border-radius: 20px;
  padding: 30px;
  margin: 20px 0;
  background: #f9f9f9;
}

.btn-action {
  background-color: #4cc9f0;
  color: white;
  padding: 12px 40px;
  border-radius: 25px;
  border: none;
  cursor: pointer;
  font-weight: bold;
}

.btn-back {
  background: none;
  border: 1px solid #3a7bd5;
  color: #3a7bd5;
  padding: 8px 20px;
  border-radius: 15px;
  cursor: pointer;
}
</style>
</head>

<body>

<!-- HOME -->
<div id="home-page">
  <section class="hero">
    <div class="logo">HYPERDESIGNER</div>
    <h1>Otimize sua gestão</h1>
    <button class="btn-main" onclick="scrollToOptions()">Começar</button>
  </section>

  <div id="options-section" class="container">
    <div class="options-grid">
      <div class="option-card">
        <h2>Modo Espelho</h2>
        <div class="card-box">Copie o layout de uma planilha modelo</div>
        <button class="btn-action" onclick="showPage('espelho')">Começar</button>
      </div>

      <div class="option-card">
        <h2>Designer Automático</h2>
        <div class="card-box">Cria um layout do zero</div>
        <button class="btn-action" disabled>Em breve</button>
      </div>
    </div>
  </div>
</div>

<!-- MODO ESPELHO -->
<div id="page-espelho" class="container hidden">
  <h1>Modo Espelho</h1>
  <p>Use um Excel modelo e um arquivo bruto</p>

  <div class="upload-area">
    <p><strong>Arquivo modelo (.xlsx)</strong></p>
    <input type="file" id="modelo" accept=".xlsx">
  </div>

  <div class="upload-area">
    <p><strong>Arquivo bruto (.csv ou .xlsx)</strong></p>
    <input type="file" id="bruto" accept=".csv,.xlsx">
  </div>

  <button class="btn-action" onclick="modoEspelho()">Gerar Excel</button>
  <br><br>
  <button class="btn-back" onclick="showPage('home')">← Voltar</button>
</div>

<!-- ExcelJS -->
<script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>

<script>
// ===== NAVEGAÇÃO =====
function scrollToOptions() {
  document.getElementById('options-section')
    .scrollIntoView({ behavior: 'smooth' });
}

function showPage(pageId) {
  document.getElementById('home-page').classList.add('hidden');
  document.getElementById('page-espelho').classList.add('hidden');

  if (pageId === 'home') {
    document.getElementById('home-page').classList.remove('hidden');
  } else {
    document.getElementById('page-' + pageId).classList.remove('hidden');
    window.scrollTo(0, 0);
  }
}

// ===== MODO ESPELHO =====
async function modoEspelho() {
  try {
    alert('Função iniciou ✔'); // DEBUG VISUAL

    const modelo = document.getElementById('modelo').files[0];
    const bruto = document.getElementById('bruto').files[0];

    if (!modelo || !bruto) {
      alert('Selecione os dois arquivos');
      return;
    }

    const wbModelo = new ExcelJS.Workbook();
    await wbModelo.xlsx.load(await modelo.arrayBuffer());
    const wsModelo = wbModelo.worksheets[0];

    if (wsModelo.rowCount > 1) {
      wsModelo.spliceRows(2, wsModelo.rowCount);
    }

    let dados = [];

    if (bruto.name.toLowerCase().endsWith('.csv')) {
      const texto = await bruto.text();
      dados = texto
        .split(/\r?\n/)
        .filter(l => l.trim() !== '')
        .slice(1)
        .map(l =>
          l.split(',').map(v =>
            v.replace(/^"|"$/g, '').trim()
          )
        );
    } else {
      const wbBruto = new ExcelJS.Workbook();
      await wbBruto.xlsx.load(await bruto.arrayBuffer());
      const wsBruto = wbBruto.worksheets[0];

      wsBruto.eachRow((row, i) => {
        if (i === 1) return;
        dados.push(row.values.slice(1));
      });
    }

    if (dados.length === 0) {
      alert('Nenhum dado encontrado');
      return;
    }

    dados.forEach(l => wsModelo.addRow(l));

    wsModelo.autoFilter = {
      from: 'A1',
      to: wsModelo.getRow(1).lastCell.address
    };

    wsModelo.views = [{ state: 'frozen', ySplit: 1 }];

    wsModelo.columns.forEach(col => {
      let max = 12;
      col.eachCell({ includeEmpty: true }, cell => {
        max = Math.max(max, String(cell.value ?? '').length);
      });
      col.width = max + 2;
    });

    const buffer = await wbModelo.xlsx.writeBuffer();
    const blob = new Blob([buffer], {
      type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
    });

    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'relatorio_formatado.xlsx';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

  } catch (e) {
    console.error(e);
    alert('Erro: ' + e.message);
  }
}
</script>



</body>
</html>
